@using ReflectionIT.Mvc.Paging;
@addTagHelper *, ReflectionIT.Mvc.Paging
@model PagingList<ACS.Core.Entities.Message>

@{
    ViewData["Title"] = "الوارد";
}
<div class="container bootdey pt-4">
    <div class="row e-rtl bg-secondary mb-3 rounded">
        <div class="row col-md-6">
            <div>
                <b class="text-white bg-dark rounded p-3 mt-2"><i class="fa fa-inbox fa-fw"></i></b>
            </div>
            @Html.Raw("&nbsp;")
            <div class="font-weight-bolder text-light" style="font-size:larger;">
                المراسلات الواردة
            </div>
        </div>
    </div>
    <div class="email-app mb-4">
        <main class="inbox">
            <div class="toolbar">
                <div class="row e-rtl">
                    @*<div class="col-md-11">
                        <select id="my_select" onchange="test()" multiple id="UsersList" class="chosen-select-rtl mb-3 form-control form-control-lg" asp-items="ViewBag.ResponsibilityCodes">
                        </select>
                        </div>*@
                    <div class="col-md-1">
                        <button style="background-color:#F08080; height:47px; width:47px;" type="button" onclick="deleteFromInbox()" class="btn btn-light" title="حذف المراسلات المحددة">
                            <span class="fa fa-ban"></span>
                        </button>
                    </div>
                </div>
                @*<div class="btn-group">
                    <button type="button" class="btn btn-light">
                    <span class="fa fa-envelope"></span>
                    </button>
                    <button type="button" class="btn btn-light">
                    <span class="fa fa-star"></span>
                    </button>
                    <button type="button" class="btn btn-light">
                    <span class="fa fa-star-o"></span>
                    </button>
                    <button type="button" class="btn btn-light">
                    <span class="fa fa-bookmark-o"></span>
                    </button>
                    </div>
                    <div class="btn-group">
                    <button type="button" class="btn btn-light">
                    <span class="fa fa-mail-reply"></span>
                    </button>
                    <button type="button" class="btn btn-light">
                    <span class="fa fa-mail-reply-all"></span>
                    </button>
                    <button type="button" class="btn btn-light">
                    <span class="fa fa-mail-forward"></span>
                    </button>
                    </div>*@

                @*<div class="btn-group">
                    <button type="button" class="btn btn-light dropdown-toggle" data-toggle="dropdown">
                    <span class="fa fa-tags"></span>
                    <span class="caret"></span>
                    </button>
                    <div class="dropdown-menu">
                    <a class="dropdown-item" href="#">add label <span class="badge badge-danger"> Home</span></a>
                    <a class="dropdown-item" href="#">add label <span class="badge badge-info"> Job</span></a>
                    <a class="dropdown-item" href="#">add label <span class="badge badge-success"> Clients</span></a>
                    <a class="dropdown-item" href="#">add label <span class="badge badge-warning"> News</span></a>
                    </div>
                    </div>*@
                @*<div class="">
                    <nav>
                    <vc:pager paging-list="@Model" />
                    </nav>
                    </div>*@
            </div>
            @* ---------------------------------------------------------- *@
            <form id="checkboxForm" asp-action="DeleteMessagesFromInbox" asp-controller="Messages" method="post">
                <ul class="messages">
                    @foreach (var item in Model)
                    {
                        if (item.Packages.FirstOrDefault(i => i.RecipintId == ViewBag.CurrentUserId || i.ResponsibilityCode == ViewBag.CurrentUserResponsibilityCode).IsReaded == false)
                        {
                            <li class="message unread">
                                <input name="MessagesIds" class="messagesCheckbox" value="@item.Id" type="checkbox" style="right: 0; top: 40%; position: absolute; z-index: 1; width:20px; height:20px;" />
                                <a asp-controller="Messages" asp-action="Message" asp-route-id="@item.Id">
                                    <div class="actions">
                                        <span class="action"><i class="fa fa-star-o"></i></span>
                                    </div>
                                    <div class="flags">
                                        @if (item.IsOrigin == true && (item.Documents.Count() > 0))
                                        {
                                            <span class="flag"><i class="fas fa-file-pdf"></i></span>
                                        }
                                        @if (item.SerialNumber != null || (item.SerialNumber == null && (item.ResponsibilityCode == null || item.ResponsibilityCode == "")))
                                        {
                                            <span class="flag"><i class="fas fa-briefcase text-black-50"></i></span>
                                        }
                                        @if (item.IsOrigin == false)
                                        {
                                            <span class="flag"><i class="fas fa-signature" style="color:blue;"></i></span>
                                        }
                                    </div>
                                    <div class="header">
                                        <span class="date">
                                            <span class="fa fa-paper-clip"></span> @Html.DisplayFor(modelItem => item.SendingDateTime)
                                        </span>
                                        <span class="from">
                                            @Html.DisplayFor(modelItem => item.SenderDiscription)
                                        </span>
                                    </div>
                                    <div class="title">
                                        <span class="text-light mr-1 bg-dark" dir="rtl">
                                            @Html.DisplayFor(modelItem => item.SerialNumber)
                                        </span>
                                        @Html.DisplayFor(modelItem => item.Title),
                                    </div>
                                    <div class="description">
                                        @Html.DisplayFor(modelItem => item.OriginalBody)
                                    </div>
                                </a>
                            </li>
                        }
                        else
                        {
                            <li class="message">
                                <input name="MessagesIds" class="messagesCheckbox" value="@item.Id" type="checkbox" style="right: 0; top: 40%; position: absolute; z-index: 1; width:20px; height:20px;" />
                                <a asp-controller="Messages" asp-action="Message" asp-route-id="@item.Id">
                                    <div class="actions">
                                        @*<span class="action"><i class="far fa-square"></i></span>*@
                                        <span class="action"><i class="fa fa-star-o"></i></span>
                                    </div>
                                    <div class="flags">
                                        @if (item.IsOrigin == true && (item.Documents.Count() > 0))
                                        {
                                            <span class="flag"><i class="fas fa-file-pdf"></i></span>
                                        }
                                        @if (item.SerialNumber != null || (item.SerialNumber == null && (item.ResponsibilityCode == null || item.ResponsibilityCode == "")))
                                        {
                                            <span class="flag"><i class="fas fa-briefcase text-black-50"></i></span>
                                        }
                                        @if (item.IsOrigin == false)
                                        {
                                            <span class="flag"><i class="fas fa-signature" style="color:blue;"></i></span>
                                        }
                                    </div>
                                    <div class="header">
                                        <span class="date">
                                            <span class="fa fa-paper-clip"></span> @Html.DisplayFor(modelItem => item.SendingDateTime)
                                        </span>
                                        <span class="from">
                                            @Html.DisplayFor(modelItem => item.SenderDiscription)
                                        </span>
                                    </div>
                                    <div class="title">
                                        <span class="text-light mr-1 bg-dark" dir="rtl">
                                            @Html.DisplayFor(modelItem => item.SerialNumber)
                                        </span>
                                        @Html.DisplayFor(modelItem => item.Title)
                                    </div>
                                    <div class="description">
                                        @Html.DisplayFor(modelItem => item.OriginalBody)
                                    </div>
                                </a>
                            </li>
                        }
                    }
                </ul>
            </form>
        </main>
    </div>
    <nav>
        <vc:pager paging-list="@Model" />
    </nav>
</div>
<script>
          function deleteFromInbox(){
          var form = document.getElementById("checkboxForm");
          var check = false;
          for (i = 0; i < form.length; i++) {
              if (form[i].checked) {
                check = true;
                break;
                }
            }
        if(check == true){
            if(confirm('سيتم حذف بعض المراسلات الواردة. هل أنت متأكد؟')){
                form.submit();
            }
        }
        else{
            alert('يرجى تحديد المراسلات المراد نقلها إلى المحذوفات');
        }
    }
</script>
@*<script>
    window.onload = function (args) {
    $('#my_select option').prop('selected', true);
    $('#my_select').trigger('chosen:updated');
    };
    </script>*@